<mxfile host="app.diagrams.net" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36" version="28.2.9">
  <diagram name="UML Component Diagram - Commission Report Service" id="0">
    <mxGraphModel dx="2316" dy="1249" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="microservice" value="" style="shape=component;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#000000;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="50" y="230" width="1110" height="800" as="geometry" />
        </mxCell>
        <mxCell id="sqlDB" value="Azure SQL Database - commission_daily_summary - commission_monthly_report - tablas externas (joins)" style="shape=component;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#000000;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="145" y="755" width="230" height="100" as="geometry" />
        </mxCell>
        <mxCell id="blobStorage" value="Azure Blob Storage - Almacena archivos TXT generados" style="shape=component;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#000000;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="1420" y="845" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="scheduler" value="Scheduler (Spring Batch)" style="shape=component;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#000000;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="180" y="245" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="repository" value="Repositories (Spring Data / JDBC)" style="shape=component;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#000000;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="180" y="605" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="3MdaXXZ5AFCEYtjjS7UK-5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="adapter" target="blobStorage">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="adapter" value="Adapters / Config (DB Connections, Blob Adapter)" style="shape=component;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#000000;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="1210" y="855" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="monthlyJob" value="Job: Monthly Consolidation Generator - Consolida datos del mes - Genera archivo TXT - Sube a Blob Storage (Frecuencia: Mensual)" style="shape=component;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#000000;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="540" y="755" width="300" height="100" as="geometry" />
        </mxCell>
        <mxCell id="retryHandler" value="Retry Handler - 3 intentos" style="shape=component;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#000000;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="730" y="545" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="logger" value="Logger / Error Control - Logs técnicos y funcionales - Auditoría de ejecución" style="shape=component;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#000000;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="930" y="415" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="scheduler_dailyJob" value="1️⃣ Ejecuta si procesos previos están completos:&lt;br&gt;app-srcr-batch-payment-comission" style="edgeStyle=orthogonalEdgeStyle;rounded=1;html=1;endArrow=block;" parent="1" source="scheduler" target="dailyJob" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="dailyJob_repository" value="2️⃣ Pobla tabla intermedia" style="edgeStyle=orthogonalEdgeStyle;rounded=1;html=1;endArrow=block;" parent="1" source="dailyJob" target="repository" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="repository_sqlDB" value="3️⃣ Inserción / actualización" style="edgeStyle=orthogonalEdgeStyle;rounded=1;html=1;endArrow=block;" parent="1" source="repository" target="sqlDB" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="scheduler_monthlyJob" value="4️⃣ Ejecuta fin de mes" style="edgeStyle=orthogonalEdgeStyle;rounded=1;html=1;endArrow=block;" parent="1" source="scheduler" target="monthlyJob" edge="1">
          <mxGeometry x="-0.0008" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="monthlyJob_sqlDB" value="5️⃣ Lectura consolidado mensual" style="edgeStyle=orthogonalEdgeStyle;rounded=1;html=1;endArrow=block;" parent="1" source="monthlyJob" target="sqlDB" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="monthlyJob_blobStorage" value="6️⃣ Genera y sube TXT" style="edgeStyle=orthogonalEdgeStyle;rounded=1;html=1;endArrow=block;" parent="1" source="monthlyJob" target="adapter" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="monthlyJob_retryHandler" value="En caso de fallo → reintento" style="edgeStyle=orthogonalEdgeStyle;rounded=1;html=1;endArrow=block;" parent="1" source="monthlyJob" target="retryHandler" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="retryHandler_logger" value="Registro de errores y reintentos" style="edgeStyle=orthogonalEdgeStyle;rounded=1;html=1;endArrow=block;" parent="1" source="retryHandler" target="logger" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="dailyJob_logger" value="Log ejecución diaria" style="edgeStyle=orthogonalEdgeStyle;rounded=1;html=1;endArrow=block;" parent="1" source="dailyJob" target="logger" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="monthlyJob_logger" value="Log ejecución mensual" style="edgeStyle=orthogonalEdgeStyle;rounded=1;html=1;endArrow=block;" parent="1" source="monthlyJob" target="logger" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="3MdaXXZ5AFCEYtjjS7UK-1" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;html=1;endArrow=block;" edge="1" parent="1" source="monthlyJob" target="sqlDB">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="636" y="525" as="sourcePoint" />
            <mxPoint x="247" y="715" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="dailyJob" value="Job: Daily Commission Aggregator - Ejecuta tras verificar procesos previos - Cruza tablas y pobla tabla intermedia (Frecuencia: Diario)" style="shape=component;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#000000;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="110" y="395" width="300" height="100" as="geometry" />
        </mxCell>
        <mxCell id="3MdaXXZ5AFCEYtjjS7UK-3" value="&lt;span style=&quot;font-size: 13px;&quot;&gt;Commission Report Service (Spring Boot Microservice)&lt;/span&gt;" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="100" y="195" width="270" height="30" as="geometry" />
        </mxCell>
        <mxCell id="3MdaXXZ5AFCEYtjjS7UK-6" value="&lt;h1 style=&quot;margin-top: 0px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;Extracción de datos de las tablas:&lt;/font&gt;&lt;/h1&gt;&lt;p&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;T29 tabla de resultados de proceso de comisiones.&lt;br&gt;T1 para datos de la empresa&lt;/font&gt;&lt;/p&gt;&lt;p&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;T5, T7 para campos relacionados al servicio&lt;/font&gt;&lt;/p&gt;&lt;p&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/p&gt;" style="text;html=1;whiteSpace=wrap;overflow=hidden;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="410" y="280" width="210" height="120" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
